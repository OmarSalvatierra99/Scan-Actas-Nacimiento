<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EscÃ¡ner de Actas | OFS Tlaxcala</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
  <!-- ===== ENCABEZADO ===== -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <img src="{{ url_for('static', filename='img/ofs_logo.png') }}" alt="Logo OFS Tlaxcala" class="ofs-logo" />
        <div class="header-text">
          <h1>EscÃ¡ner de Actas de Nacimiento</h1>
          <p>Sistema oficial de digitalizaciÃ³n y registro de actas</p>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <img src="{{ url_for('static', filename='img/avatar_default.png') }}" alt="Usuario" class="avatar" />
          <div>
            <h2>Gobierno del Estado de Tlaxcala</h2>
            <p>Ã“rgano de FiscalizaciÃ³n Superior</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <main class="container">
    <section class="scan-methods">
      <div class="method-tabs">
        <button class="tab-btn active" data-tab="pdf">ğŸ“„ Subir Acta PDF</button>
        <button class="tab-btn" data-tab="usb">ğŸ”Œ Lector QR USB</button>
      </div>

      <!-- ===== PESTAÃ‘A PDF ===== -->
      <div id="pdf-tab" class="tab-content active">
        <div class="pdf-container">
          <div class="pdf-instructions">
            <h3>Instrucciones para subir acta PDF</h3>
            <ol>
              <li>Seleccione el archivo PDF del acta de nacimiento.</li>
              <li>El sistema analizarÃ¡ automÃ¡ticamente los cÃ³digos QR.</li>
              <li>Se procesarÃ¡n todas las actas encontradas.</li>
            </ol>
            <div class="alert alert-warning" style="margin-top:1rem;">
              <strong>ğŸ’¡ Tip:</strong> Puede subir varios PDFs, el sistema procesarÃ¡ todos los cÃ³digos encontrados.
            </div>
          </div>

          <div class="form-group">
            <input type="file" id="pdfInput" accept=".pdf" class="file-input" style="display: none;">
            <label for="pdfInput" class="btn btn-primary">ğŸ“„ Seleccionar PDF</label>
            <span id="pdfFileName"></span>
          </div>

          <div id="pdfProgress" style="display:none;">
            <div class="alert alert-info" style="text-align:center;">
              <p>ğŸ”„ Procesando PDF, por favor espere...</p>
              <div style="background:#e2e8f0;border-radius:10px;height:10px;margin:10px 0;">
                <div id="pdfProgressBar" style="background:var(--color-primary-light);height:100%;width:0%;border-radius:10px;transition:width 0.3s;"></div>
              </div>
            </div>
          </div>

          <div id="pdfResults"></div>
        </div>
      </div>

      <!-- ===== PESTAÃ‘A USB ===== -->
      <div id="usb-tab" class="tab-content">
        <div class="usb-container">
          <div class="usb-instructions">
            <h3>Instrucciones para lector QR USB</h3>
            <ol>
              <li>Conecte el lector QR USB.</li>
              <li>Haga clic en el campo de texto inferior.</li>
              <li>Escanee el cÃ³digo QR y presione ENTER.</li>
            </ol>
            <div class="alert alert-info" style="margin-top:1rem;">
              <strong>âš¡ RÃ¡pido:</strong> Cada lectura se guarda automÃ¡ticamente y prepara el siguiente escaneo.
            </div>
          </div>

          <div class="form-group">
            <label for="usbInput">Datos del lector USB</label>
            <input type="text" id="usbInput" class="usb-input" placeholder="Haga clic aquÃ­ y escanee con el lector USB..." />
          </div>
          <button id="btnProcessUSB" class="btn btn-primary" disabled>ğŸ’¾ Guardar Acta</button>
        </div>
      </div>
    </section>

    <!-- ===== MENSAJE GLOBAL ===== -->
    <div id="resultMessage" class="result-message"></div>

    <!-- ===== PANEL DE CONTROL ===== -->
    <section class="controls-panel">
      <div class="stats">
        Total de actas escaneadas: <strong id="totalRegistros">{{ total }}</strong>
      </div>
      <div class="actions">
        <a href="{{ url_for('descargar_excel') }}" class="btn btn-download">ğŸ“¥ Descargar Excel</a>
        <button id="btnLimpiar" class="btn btn-error">ğŸ—‘ï¸ Limpiar Todo</button>
      </div>
    </section>

    <!-- ===== TABLA DE RESULTADOS ===== -->
    <section class="table-panel">
      <h2>ğŸ“‹ Actas Escaneadas (mÃ¡s recientes primero)</h2>
      {% include '_tabla_registros.html' %}
    </section>
  </main>

  <!-- ===== PIE DE PÃGINA ===== -->
  <footer class="footer">
    <p>&copy; {{ current_year }} Gobierno del Estado de Tlaxcala Â· Ã“rgano de FiscalizaciÃ³n Superior</p>
  </footer>

  <!-- ===== SCRIPT PRINCIPAL ===== -->
  <script>
    // === SISTEMA DE PESTAÃ‘AS ===
    document.addEventListener('DOMContentLoaded', () => {
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.getAttribute('data-tab');

          // Quitar "active" de todos
          tabButtons.forEach(b => b.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));

          // Activar seleccionado
          btn.classList.add('active');
          document.getElementById(`${tab}-tab`).classList.add('active');

          // Si es USB, enfocar campo automÃ¡ticamente
          if (tab === 'usb') {
            setTimeout(() => {
              const usbInput = document.getElementById('usbInput');
              if (usbInput) usbInput.focus();
            }, 200);
          }
        });
      });
    });
  </script>

  <!-- Tu lÃ³gica principal puede seguir en main.js -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

